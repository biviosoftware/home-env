#!/usr/bin/env bash
b_pyenv_install_version="$1"
if [ -z $b_pyenv_install_version ]; then
    echo "expecting a python version" 1>&2
    echo "usage: $0 version" 1>&2
    exit 1
fi
. ~/.bashrc
if [ ! -d ~/.pyenv ]; then
    curl -L https://raw.githubusercontent.com/yyuu/pyenv-installer/master/bin/pyenv-installer | bash
    # Newer versions of patch do not like relative file names. Give this warning:
    # 'Ignoring potentially dangerous file name ../Python-2.7.8/Lib/site.py'
    # Updating the patches this way fixes the problem
    perl -pi -e 's{^(\+\+\+|--- |diff.* )\.\./}{$1}' $(find ~/.pyenv -name \*.patch)
fi
if [ Darwin = $(uname) ]; then
    export CFLAGS="-I$(xcrun --show-sdk-path)/usr/include"
fi
pyenv install $b_pyenv_install_version
pyenv global $b_pyenv_install_version
