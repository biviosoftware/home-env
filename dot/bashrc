#!/bin/bash
(set -o igncr) &>/dev/null && set -o igncr && export SHELLOPTS # ignore cr
#
# DO NOT EDIT THIS FILE.
#
# How To Customize
#
# If you are running in RadiaSoft's Jupyter environment, create ~/jupyter/bashrc,
# which will be saved between server starts.
#
# If you are running on a Mac or Linux, create ~/.pre_bivio_bashrc
# or ~/.post_bivio_bashrc, which are executed as the first and last
# by this file (see below), respectively

# This avoids recursion on scripts called from ~/.bashrc
unset BASH_ENV

_bivio_bashrc_init() {
    # Source the files while avoiding recursion
    local -i _bivio_bashrc_init_seen=${_bivio_bashrc_init_seen:-0}
    _bivio_bashrc_init_seen+=1
    if (( _bivio_bashrc_init_seen > 3 )); then
        echo "$HOME/.bashrc: sourced in an infinite recursion ($_bivio_bashrc_init_seen), exiting 'source'" 1>&2
        return
    fi
    local f
    for f in \
        "$HOME"/.pre_bivio_bashrc \
        /etc/bashrc \
        "$HOME"/src/*/home-env/bashrc.d/*.sh \
        "$HOME"/.post_bivio_bashrc \
        ; do
        if [[ -f $f ]]; then
            source "$f"
        fi
    done
    _bivio_bashrc_init_seen+=-1
}

# $HOME condition is for backwards compatibility for job_agent:
# https://github.com/radiasoft/sirepo/blob/86b837682df9a26f6/sirepo/pkcli/job_agent.py#L570
if [[ ${SHIFTER_RUNTIME:-} && $HOME != /home/vagrant ]]; then
    ulimit -c 0
    unset PYTHONPATH
    unset PYTHONSTARTUP
    export PYENV_ROOT=/home/vagrant/.pyenv
    export HOME=/home/vagrant
    _bivio_bashrc_init
    eval export HOME=~$USER
else
    _bivio_bashrc_init
fi
unset -f _bivio_bashrc_init
